```text
SPDX-License-Identifier: Apache-2.0
Copyright Â© 2019 Intel Corporation 
```
# 1. Introduction
## Directory Structure
- `/cmd` : Main applications inside. 
- `/pkg` : Lib code used by applications. Perphaps common libs such as lib or utils in the folder. 
- `/dist` : Built golang binaries inside. 
- `/test` : Test apps and Test data inside. 
- `/configs` : Configuration files inside. 
- `/scripts` : Scripts files inside. 

# 2. Prerequisites

## Tools
- `make` (version 3.81 or higher)
- `golang` (version 1.12.4)
- `openssl` (version 1.0.2 or higher)
- `curl` (version 7.29.0 or higher)

# 3. Quick Start

## AF
### Build

To build af:

```sh
make af
```
Generated bin will be put under `ngc/dist`

AF sample code, generated bin will be put under ngc/dist


AF configurable parameters list:

| Param              | Description                                               |
|--------------------|-----------------------------------------------------------|
| AfID               | AF ID provided by OAM during AF registration              |
| CNCAEndpoint       | HTTP EndPoint. Used by CNCA to access AF via HTTP         |
| Hostname           | Provided by AF to NEF. Part of URL used by  notifications |
| NotifPort          | NGC EndPoint. Used by NEF to send notifications to AF     |
| NotifServerCertPath| Path to certs used by AF server awaiting notification     |
| NotifServerKeyPath | Path to keys used for HTTPS connection between AF and NEF |
| NEFBasePath        | URL used by AF to access NEF                              |
| UserAgent          | Used by AF client connecting to NEF                       |
| NEFClientCertPath  | Path to certs used by AF client                           | 

To run af, just execute as below:
```sh
./af
```

> NOTE: The AF bin will load configuration from `configs/af.json`, so before execution please have nef configuration file in the configs folder

To run AF Ginkgo test suite run

```sh
make test-unit-af
```

## NEF

### Build

To build nef:

```sh
make nef
```
Generated bin will be put under `ngc/dist`

### Configure and Run NEF bin

NEF Config Example File - `nef.json` located at `ngc/configs`

#### The configurable parameters list:

| Param         | Description                                              |
|---------------|----------------------------------------------------------|
| NefAPIRoot    | The API root of the NEF i.e. ip address or domain name   |
| LocationPrefix| The API prefix for the traffic influence subscription. The NefAPIRoot + Endpoint + LocationPrefix + subscription id generated by NEF form the subscription resource uri       |
| MaxSubSupport | The maximum number of subscriptions to be supported by NEF.                 |
| MaxAFSupport  | The maximum number of AF's to be supported by NEF           |
| SubStartId    | The start value of  the subscription ids              |
| UpfNotificationResUriPath | The API path on which the the NEF would listen for UPF notifications from SMF. The NefAPI + EndPoint + UpfNotificationResUriPath together form the notification URI |
| UserAgent     | The user agent information to put in the HTTP requests|
| HTTPConfig    | The fields under this describe the configuration for the HTTP Endpoint |
| Endpoint      | The end point where the NEF server needs to listen for HTTP 1.1 requests.Format ipaddress:port |
| HTTP2Config   | The fields under this describe the configuration for the HTTP2 Endpoint |
| Endpoint      | The end point where the NEF server needs to listen for HTTP 2.1 requests. Format ipaddress:port |
| NefServerCert | The file path containing the NEF Server public key    |
| NefServerKey  | The file path containing the NEF Server private key   |
| AfClientCert  | The file path containing the AF Server public key     |
| AfServiceID   | List of mappings for AfServiceID to dnn and snssai, used by NEF when communicating with UDR and PCF |
| id            | The AF Service ID  |
| dnn           | Data network name |
| snssai        | Single Network Slice Selection Assistance Information |

#### Run NEF
To run nef, just execute as below:
```sh
./nef
```
> NOTE: 
1. The NEF will load configuration from `/configs/nef.json`, so before execution please have nef configuration file in the configs folder
2. The NEF certificates need to be available in the location mentioned in the configuration

## Certifications Generation

To generate certifications for TLS, can use shell script - `genCerts.sh` in `ngc/scripts`. 
Can get detail usage by executing the script as: `./genCerts.sh ?` .

## Launch the emulator
After building AF and NEF, the emulator can be set up as below:
```sh
./start.sh
```
More infomation regarding the emulator can be referred to start.sh.
